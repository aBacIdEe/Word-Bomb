<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Word Game</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #333;
        }

        .container {
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            width: 90%;
            max-width: 800px;
            min-height: 600px;
            overflow: hidden;
            position: relative;
        }

        .header {
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
            color: white;
            padding: 1.5rem;
            text-align: center;
        }

        .header h1 {
            font-size: 2rem;
            margin-bottom: 0.5rem;
        }

        .header .subtitle {
            opacity: 0.9;
            font-size: 1rem;
        }

        .content {
            padding: 2rem;
            min-height: 500px;
        }

        .screen {
            display: none;
        }

        .screen.active {
            display: block;
        }

        /* Home Screen */
        .home-actions {
            display: grid;
            gap: 1rem;
            max-width: 400px;
            margin: 2rem auto;
        }

        .btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 1rem 2rem;
            border-radius: 10px;
            font-size: 1.1rem;
            cursor: pointer;
            transition: transform 0.2s, box-shadow 0.2s;
            border: 2px solid transparent;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(0,0,0,0.2);
        }

        .btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }

        .btn.secondary {
            background: white;
            color: #667eea;
            border: 2px solid #667eea;
        }

        .input-group {
            margin: 1rem 0;
        }

        .input-group label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 600;
            color: #555;
        }

        .input-group input, .input-group select {
            width: 100%;
            padding: 0.75rem;
            border: 2px solid #e1e5e9;
            border-radius: 8px;
            font-size: 1rem;
            transition: border-color 0.2s;
        }

        .input-group input:focus, .input-group select:focus {
            outline: none;
            border-color: #667eea;
        }

        /* Room List */
        .room-list {
            max-height: 300px;
            overflow-y: auto;
            border: 1px solid #e1e5e9;
            border-radius: 8px;
            margin: 1rem 0;
        }

        .room-item {
            padding: 1rem;
            border-bottom: 1px solid #e1e5e9;
            cursor: pointer;
            transition: background-color 0.2s;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .room-item:hover {
            background-color: #f8f9fa;
        }

        .room-info h3 {
            margin-bottom: 0.25rem;
            color: #333;
        }

        .room-info p {
            color: #666;
            font-size: 0.9rem;
        }

        .room-status {
            padding: 0.25rem 0.75rem;
            border-radius: 15px;
            font-size: 0.8rem;
            font-weight: 600;
        }

        .room-status.waiting {
            background: #e3f2fd;
            color: #1976d2;
        }

        .room-status.in-progress {
            background: #fff3e0;
            color: #f57c00;
        }

        /* Game Screen */
        .game-header {
            background: #f8f9fa;
            padding: 1rem;
            border-radius: 8px;
            margin-bottom: 1.5rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 1rem;
        }

        .game-info {
            display: flex;
            gap: 2rem;
            flex-wrap: wrap;
        }

        .game-info-item {
            text-align: center;
        }

        .game-info-item .label {
            font-size: 0.8rem;
            color: #666;
            text-transform: uppercase;
            font-weight: 600;
        }

        .game-info-item .value {
            font-size: 1.2rem;
            font-weight: bold;
            color: #333;
        }

        .timer {
            background: linear-gradient(135deg, #ff6b6b, #ee5a24);
            color: white;
            padding: 0.5rem 1rem;
            border-radius: 20px;
            font-weight: bold;
            font-size: 1.1rem;
        }

        .timer.warning {
            animation: pulse 1s infinite;
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }

        .prompt-section {
            text-align: center;
            margin: 2rem 0;
            padding: 2rem;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-radius: 15px;
        }

        .prompt-section h2 {
            font-size: 1.8rem;
            margin-bottom: 0.5rem;
        }

        .prompt-section .difficulty {
            opacity: 0.9;
            font-size: 0.9rem;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .word-input-section {
            margin: 2rem 0;
            text-align: center;
        }

        .word-input {
            font-size: 1.5rem;
            padding: 1rem;
            width: 100%;
            max-width: 400px;
            text-align: center;
            border: 3px solid #e1e5e9;
            border-radius: 10px;
            margin-bottom: 1rem;
        }

        .word-input:focus {
            border-color: #667eea;
            outline: none;
        }

        .submission-status {
            background: #f8f9fa;
            padding: 1rem;
            border-radius: 8px;
            margin: 1rem 0;
        }

        .players-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
            margin: 1.5rem 0;
        }

        .player-card {
            background: #f8f9fa;
            padding: 1rem;
            border-radius: 8px;
            text-align: center;
            position: relative;
        }

        .player-card.submitted {
            background: #e8f5e8;
            border: 2px solid #4caf50;
        }

        .player-card.you {
            background: #e3f2fd;
            border: 2px solid #2196f3;
        }

        .player-name {
            font-weight: 600;
            margin-bottom: 0.5rem;
        }

        .player-score {
            font-size: 1.2rem;
            color: #667eea;
            font-weight: bold;
        }

        .checkmark {
            position: absolute;
            top: 0.5rem;
            right: 0.5rem;
            color: #4caf50;
            font-size: 1.2rem;
        }

        /* Results Screen */
        .results-section {
            margin: 2rem 0;
        }

        .results-table {
            width: 100%;
            border-collapse: collapse;
            margin: 1rem 0;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        .results-table th {
            background: #667eea;
            color: white;
            padding: 1rem;
            text-align: left;
        }

        .results-table td {
            padding: 1rem;
            border-bottom: 1px solid #e1e5e9;
        }

        .results-table tr:nth-child(even) {
            background: #f8f9fa;
        }

        .word-result.valid {
            color: #4caf50;
            font-weight: 600;
        }

        .word-result.invalid {
            color: #f44336;
            text-decoration: line-through;
        }

        .correct-answers {
            background: #e8f5e8;
            padding: 1rem;
            border-radius: 8px;
            margin: 1rem 0;
        }

        .correct-answers h4 {
            color: #2e7d2e;
            margin-bottom: 0.5rem;
        }

        .answer-tags {
            display: flex;
            flex-wrap: wrap;
            gap: 0.5rem;
        }

        .answer-tag {
            background: #4caf50;
            color: white;
            padding: 0.25rem 0.75rem;
            border-radius: 15px;
            font-size: 0.9rem;
        }

        /* Settings */
        .settings-grid {
            display: grid;
            gap: 1rem;
            margin: 1rem 0;
        }

        /* Messages */
        .message {
            padding: 1rem;
            border-radius: 8px;
            margin: 1rem 0;
        }

        .message.error {
            background: #ffebee;
            color: #c62828;
            border-left: 4px solid #f44336;
        }

        .message.success {
            background: #e8f5e8;
            color: #2e7d2e;
            border-left: 4px solid #4caf50;
        }

        .message.info {
            background: #e3f2fd;
            color: #1565c0;
            border-left: 4px solid #2196f3;
        }

        /* Utility */
        .text-center { text-align: center; }
        .mb-1 { margin-bottom: 1rem; }
        .mb-2 { margin-bottom: 2rem; }
        .hidden { display: none; }

        /* Responsive */
        @media (max-width: 768px) {
            .container {
                width: 95%;
                margin: 1rem;
            }
            
            .content {
                padding: 1rem;
            }
            
            .game-info {
                gap: 1rem;
            }
            
            .players-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>🎯 Word Game</h1>
            <div class="subtitle">Real-time multiplayer word challenge</div>
        </div>

        <div class="content">
            <!-- Home Screen -->
            <div id="homeScreen" class="screen active">
                <div class="home-actions">
                    <div class="input-group">
                        <label for="playerName">Your Name</label>
                        <input type="text" id="playerName" placeholder="Enter your name" maxlength="20">
                    </div>
                    
                    <button class="btn" onclick="createRoom()">🎮 Create New Game</button>
                    <button class="btn secondary" onclick="showJoinRoom()">🚪 Join Game</button>
                    <button class="btn secondary" onclick="showRoomList()">📋 Browse Games</button>
                </div>

                <div id="joinRoomSection" class="hidden">
                    <div class="input-group">
                        <label for="roomIdInput">Room Code</label>
                        <input type="text" id="roomIdInput" placeholder="Enter room code" maxlength="10">
                    </div>
                    <button class="btn" onclick="joinRoom()">Join Room</button>
                    <button class="btn secondary" onclick="hideJoinRoom()">Cancel</button>
                </div>

                <div id="roomListSection" class="hidden">
                    <h3>Active Games</h3>
                    <div id="roomList" class="room-list">
                        <div class="text-center" style="padding: 2rem;">Loading...</div>
                    </div>
                    <button class="btn secondary" onclick="hideRoomList()">Back</button>
                </div>
            </div>

            <!-- Lobby Screen -->
            <div id="lobbyScreen" class="screen">
                <div class="game-header">
                    <div>
                        <h2>Game Lobby</h2>
                        <p>Room Code: <strong id="currentRoomId"></strong></p>
                    </div>
                    <button class="btn secondary" onclick="leaveRoom()">Leave Room</button>
                </div>

                <div class="players-grid" id="lobbyPlayers">
                    <!-- Players will be populated here -->
                </div>

                <div id="gameSettings" class="hidden">
                    <h3>Game Settings</h3>
                    <div class="settings-grid">
                        <div class="input-group">
                            <label for="maxPlayers">Max Players (2-20)</label>
                            <input type="number" id="maxPlayers" min="2" max="20" value="8">
                        </div>
                        <div class="input-group">
                            <label for="turnTimeLimit">Turn Time Limit</label>
                            <select id="turnTimeLimit">
                                <option value="15000">15 seconds</option>
                                <option value="30000" selected>30 seconds</option>
                                <option value="60000">1 minute</option>
                                <option value="120000">2 minutes</option>
                            </select>
                        </div>
                        <div class="input-group">
                            <label for="maxRounds">Number of Rounds</label>
                            <select id="maxRounds">
                                <option value="5">5 rounds</option>
                                <option value="10" selected>10 rounds</option>
                                <option value="15">15 rounds</option>
                                <option value="20">20 rounds</option>
                            </select>
                        </div>
                        <div class="input-group">
                            <label for="difficulty">Difficulty</label>
                            <select id="difficulty">
                                <option value="">Random</option>
                                <option value="easy">Easy</option>
                                <option value="medium">Medium</option>
                                <option value="hard">Hard</option>
                            </select>
                        </div>
                    </div>
                    <button class="btn" onclick="updateSettings()">Update Settings</button>
                </div>

                <div class="text-center mb-2">
                    <button id="startGameBtn" class="btn hidden" onclick="startGame()">🚀 Start Game</button>
                </div>
            </div>

            <!-- Game Screen -->
            <div id="gameScreen" class="screen">
                <div class="game-header">
                    <div class="game-info">
                        <div class="game-info-item">
                            <div class="label">Round</div>
                            <div class="value" id="currentRound">1</div>
                        </div>
                        <div class="game-info-item">
                            <div class="label">Total Rounds</div>
                            <div class="value" id="totalRounds">10</div>
                        </div>
                        <div class="game-info-item">
                            <div class="label">Players</div>
                            <div class="value" id="playerCount">4</div>
                        </div>
                    </div>
                    <div class="timer" id="gameTimer">30</div>
                </div>

                <div class="prompt-section">
                    <h2 id="gamePrompt">Loading prompt...</h2>
                    <div class="difficulty" id="promptDifficulty">MEDIUM</div>
                </div>

                <div id="wordInputSection" class="word-input-section">
                    <input type="text" id="wordInput" class="word-input" placeholder="Enter your word here..." maxlength="50">
                    <br>
                    <button class="btn" onclick="submitWord()" id="submitBtn">Submit Word</button>
                </div>

                <div id="submissionStatus" class="submission-status hidden">
                    <h4>✅ Word Submitted!</h4>
                    <p>Waiting for other players... (<span id="submissionCount">1</span>/<span id="totalPlayers">4</span>)</p>
                </div>

                <div class="players-grid" id="gamePlayers">
                    <!-- Players will be populated here -->
                </div>
            </div>

            <!-- Results Screen -->
            <div id="resultsScreen" class="screen">
                <div class="results-section">
                    <h2>Round <span id="resultsRound">1</span> Results</h2>
                    
                    <table class="results-table">
                        <thead>
                            <tr>
                                <th>Player</th>
                                <th>Word</th>
                                <th>Valid</th>
                                <th>Points</th>
                            </tr>
                        </thead>
                        <tbody id="resultsTableBody">
                            <!-- Results will be populated here -->
                        </tbody>
                    </table>

                    <div class="correct-answers">
                        <h4>Some Correct Answers:</h4>
                        <div class="answer-tags" id="correctAnswerTags">
                            <!-- Correct answers will be populated here -->
                        </div>
                    </div>

                    <div class="game-header">
                        <h3>Current Leaderboard</h3>
                        <div id="leaderboard">
                            <!-- Leaderboard will be populated here -->
                        </div>
                    </div>
                </div>
            </div>

            <!-- Final Results Screen -->
            <div id="finalResultsScreen" class="screen">
                <div class="text-center mb-2">
                    <h2>🎉 Game Complete!</h2>
                </div>

                <div class="game-header">
                    <h3>Final Leaderboard</h3>
                    <div id="finalLeaderboard">
                        <!-- Final leaderboard will be populated here -->
                    </div>
                </div>

                <div class="text-center mb-2">
                    <button class="btn" onclick="backToLobby()">🔄 Play Again</button>
                    <button class="btn secondary" onclick="backToHome()">🏠 Home</button>
                </div>
            </div>
        </div>

        <!-- Messages -->
        <div id="messageContainer" style="position: fixed; top: 20px; right: 20px; z-index: 1000; max-width: 300px;">
            <!-- Messages will appear here -->
        </div>
    </div>

    <script>
        // Game state
        let ws = null;
        let currentPlayer = null;
        let currentRoom = null;
        let gameState = null;
        let isCreator = false;
        let gameTimer = null;

        // WebSocket connection
        function connectWebSocket() {
            const protocol = window.location.protocol === 'https:' ? 'wss:' : 'ws:';
            const host = window.location.host;
            const wsUrl = `${protocol}//${host}`;
            
            console.log('Connecting to:', wsUrl);
            ws = new WebSocket(wsUrl);
            
            ws.onopen = function() {
                console.log('Connected to server');
                showMessage('Connected to server', 'success');
            };
            
            ws.onmessage = function(event) {
                const message = JSON.parse(event.data);
                handleServerMessage(message);
            };
            
            ws.onclose = function() {
                console.log('Disconnected from server');
                showMessage('Disconnected from server', 'error');
                setTimeout(connectWebSocket, 3000); // Reconnect after 3 seconds
            };
            
            ws.onerror = function(error) {
                console.error('WebSocket error:', error);
                showMessage('Connection error', 'error');
            };
        }

        // Message handling
        function handleServerMessage(message) {
            console.log('Received:', message);
            
            switch(message.type) {
                case 'room_joined':
                    currentPlayer = {
                        id: message.playerId,
                        name: document.getElementById('playerName').value
                    };
                    currentRoom = message.roomId;
                    isCreator = message.isCreator;
                    document.getElementById('currentRoomId').textContent = message.roomId;
                    updateLobbyPlayers(message.players);
                    showScreen('lobbyScreen');
                    if (isCreator) {
                        document.getElementById('gameSettings').classList.remove('hidden');
                        document.getElementById('startGameBtn').classList.remove('hidden');
                    }
                    break;
                    
                case 'player_joined':
                    showMessage(`${message.player.name} joined the game`, 'info');
                    addPlayerToLobby(message.player);
                    break;
                    
                case 'player_left':
                    showMessage(`${message.playerName} left the game`, 'info');
                    removePlayerFromLobby(message.playerId);
                    break;
                    
                case 'game_started':
                    gameState = message.gameState;
                    showMessage('Game started!', 'success');
                    break;
                    
                case 'round_started':
                    startRound(message);
                    break;
                    
                case 'word_submitted':
                    onWordSubmitted(message);
                    break;
                    
                case 'player_submitted':
                    onPlayerSubmitted(message);
                    break;
                    
                case 'round_ended':
                    showRoundResults(message);
                    break;
                    
                case 'game_finished':
                    showFinalResults(message);
                    break;
                    
                case 'room_reset':
                    showMessage('Room reset - ready for new game', 'info');
                    showScreen('lobbyScreen');
                    break;
                    
                case 'settings_updated':
                    updateSettingsDisplay(message.settings);
                    break;
                    
                case 'error':
                    showMessage(message.message, 'error');
                    break;
            }
        }

        // Room management
        function createRoom() {
            const playerName = document.getElementById('playerName').value.trim();
            if (!playerName) {
                showMessage('Please enter your name', 'error');
                return;
            }
            
            fetch('/api/games', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ settings: {} })
            })
            .then(response => response.json())
            .then(data => {
                connectWebSocket();
                setTimeout(() => {
                    sendMessage({
                        type: 'join_room',
                        roomId: data.roomId,
                        playerName: playerName
                    });
                }, 100);
            })
            .catch(error => {
                showMessage('Failed to create room', 'error');
            });
        }

        function showJoinRoom() {
            document.getElementById('joinRoomSection').classList.remove('hidden');
        }

        function hideJoinRoom() {
            document.getElementById('joinRoomSection').classList.add('hidden');
        }

        function joinRoom() {
            const playerName = document.getElementById('playerName').value.trim();
            const roomId = document.getElementById('roomIdInput').value.trim().toUpperCase();
            
            if (!playerName) {
                showMessage('Please enter your name', 'error');
                return;
            }
            
            if (!roomId) {
                showMessage('Please enter room code', 'error');
                return;
            }
            
            connectWebSocket();
            setTimeout(() => {
                sendMessage({
                    type: 'join_room',
                    roomId: roomId,
                    playerName: playerName
                });
            }, 100);
        }

        function showRoomList() {
            document.getElementById('roomListSection').classList.remove('hidden');
            loadRoomList();
        }

        function hideRoomList() {
            document.getElementById('roomListSection').classList.add('hidden');
        }

        function loadRoomList() {
            fetch('/api/games')
                .then(response => response.json())
                .then(rooms => {
                    const roomList = document.getElementById('roomList');
                    
                    if (rooms.length === 0) {
                        roomList.innerHTML = '<div class="text-center" style="padding: 2rem;">No active games</div>';
                        return;
                    }
                    
                    roomList.innerHTML = rooms.map(room => `
                        <div class="room-item" onclick="joinSpecificRoom('${room.id}')">
                            <div class="room-info">
                                <h3>${room.id}</h3>
                                <p>${room.playerCount}/${room.maxPlayers} players</p>
                            </div>
                            <div class="room-status ${room.status}">${room.status}</div>
                        </div>
                    `).join('');
                })
                .catch(error => {
                    document.getElementById('roomList').innerHTML = '<div class="text-center" style="padding: 2rem;">Failed to load rooms</div>';
                });
        }

        function joinSpecificRoom(roomId) {
            const playerName = document.getElementById('playerName').value.trim();
            if (!playerName) {
                showMessage('Please enter your name first', 'error');
                return;
            }
            
            document.getElementById('roomIdInput').value = roomId;
            hideRoomList();
            joinRoom();
        }

        function leaveRoom() {
            if (ws) {
                ws.close();
            }
            currentPlayer = null;
            currentRoom = null;
            isCreator = false;
            gameState = null;
            clearGameTimer();
            showScreen('homeScreen');
        }

        // Game functions
        function startGame() {
            sendMessage({ type: 'start_game' });
        }

        function startRound(message) {
            showScreen('gameScreen');
            
            document.getElementById('currentRound').textContent = message.round;
            document.getElementById('totalRounds').textContent = message.totalRounds;
            document.getElementById('gamePrompt').textContent = message.prompt;
            document.getElementById('promptDifficulty').textContent = message.difficulty.toUpperCase();
            
            // Reset input
            document.getElementById('wordInput').value = '';
            document.getElementById('wordInput').disabled = false;
            document.getElementById('submitBtn').disabled = false;
            document.getElementById('submissionStatus').classList.add('hidden');
            document.getElementById('wordInputSection').classList.remove('hidden');
            
            // Start timer
            startGameTimer(message.timeLimit);
            
            // Focus input
            document.getElementById('wordInput').focus();
        }

        function submitWord() {
            const word = document.getElementById('wordInput').value.trim();
            if (!word) {
                showMessage('Please enter a word', 'error');
                return;
            }
            
            sendMessage({
                type: 'submit_word',
                word: word
            });
        }

        function onWordSubmitted(message) {
            document.getElementById('wordInput').disabled = true;
            document.getElementById('submitBtn').disabled = true;
            document.getElementById('wordInputSection').classList.add('hidden');
            document.getElementById('submissionStatus').classList.remove('hidden');
            document.getElementById('submissionCount').textContent = message.submissionCount;
            document.getElementById('totalPlayers').textContent = message.totalPlayers;
        }

        function onPlayerSubmitted(message) {
            document.getElementById('submissionCount').textContent = message.submissionCount;
            // Update player card to show submitted
            updatePlayerSubmissionStatus(message.playerName, true);
        }

        function showRoundResults(message) {
            clearGameTimer();
            showScreen('resultsScreen');
            
            document.getElementById('resultsRound').textContent = message.round;
            
            // Populate results table
            const tbody = document.getElementById('resultsTableBody');
            tbody.innerHTML = message.results.map(result => `
                <tr>
                    <td>${result.playerName}</td>
                    <td class="word-result ${result.isValid ? 'valid' : 'invalid'}">${result.word}</td>
                    <td>${result.isValid ? '✅' : '❌'}</td>
                    <td>${result.points}</td>
                </tr>
            `).join('');
            
            // Show correct answers
            const correctAnswerTags = document.getElementById('correctAnswerTags');
            correctAnswerTags.innerHTML = message.correctAnswers.map(answer => 
                `<span class="answer-tag">${answer}</span>`
            ).join('');
            
            // Update leaderboard
            updateLeaderboard(message.leaderboard, 'leaderboard');
            
            // Auto-advance to next round or final results
            setTimeout(() => {
                // This will be handled by the server sending the next round or game_finished
            }, 5000);
        }

        function showFinalResults(message) {
            clearGameTimer();
            showScreen('finalResultsScreen');
            updateLeaderboard(message.finalLeaderboard, 'finalLeaderboard');
            
            // Show confetti or celebration for winner
            const winner = message.finalLeaderboard[0];
            if (winner && winner.id === currentPlayer.id) {
                showMessage('🎉 Congratulations! You won!', 'success');
            }
        }

        function backToLobby() {
            showScreen('lobbyScreen');
        }

        function backToHome() {
            leaveRoom();
        }

        // Settings
        function updateSettings() {
            const settings = {
                maxPlayers: parseInt(document.getElementById('maxPlayers').value),
                turnTimeLimit: parseInt(document.getElementById('turnTimeLimit').value),
                maxRounds: parseInt(document.getElementById('maxRounds').value),
                difficulty: document.getElementById('difficulty').value || null
            };
            
            sendMessage({
                type: 'update_settings',
                settings: settings
            });
        }

        function updateSettingsDisplay(settings) {
            document.getElementById('maxPlayers').value = settings.maxPlayers;
            document.getElementById('turnTimeLimit').value = settings.turnTimeLimit;
            document.getElementById('maxRounds').value = settings.maxRounds;
            document.getElementById('difficulty').value = settings.difficulty || '';
        }

        // Timer
        function startGameTimer(duration) {
            clearGameTimer();
            let timeLeft = Math.floor(duration / 1000);
            const timerElement = document.getElementById('gameTimer');
            
            function updateTimer() {
                timerElement.textContent = timeLeft;
                
                if (timeLeft <= 10) {
                    timerElement.classList.add('warning');
                } else {
                    timerElement.classList.remove('warning');
                }
                
                if (timeLeft <= 0) {
                    clearGameTimer();
                    return;
                }
                
                timeLeft--;
            }
            
            updateTimer();
            gameTimer = setInterval(updateTimer, 1000);
        }

        function clearGameTimer() {
            if (gameTimer) {
                clearInterval(gameTimer);
                gameTimer = null;
            }
        }

        // UI helpers
        function showScreen(screenId) {
            document.querySelectorAll('.screen').forEach(screen => {
                screen.classList.remove('active');
            });
            document.getElementById(screenId).classList.add('active');
        }

        function updateLobbyPlayers(players) {
            const container = document.getElementById('lobbyPlayers');
            container.innerHTML = players.map(player => `
                <div class="player-card ${player.id === currentPlayer.id ? 'you' : ''}">
                    <div class="player-name">${player.name}${player.id === currentPlayer.id ? ' (You)' : ''}</div>
                    <div class="player-score">Ready</div>
                </div>
            `).join('');
        }

        function addPlayerToLobby(player) {
            const container = document.getElementById('lobbyPlayers');
            const playerCard = document.createElement('div');
            playerCard.className = 'player-card';
            playerCard.innerHTML = `
                <div class="player-name">${player.name}</div>
                <div class="player-score">Ready</div>
            `;
            container.appendChild(playerCard);
        }

        function removePlayerFromLobby(playerId) {
            // This would need more sophisticated tracking to remove the right player
            // For now, we'll just reload the lobby when players leave
        }

        function updatePlayerSubmissionStatus(playerName, submitted) {
            const playerCards = document.querySelectorAll('#gamePlayers .player-card');
            playerCards.forEach(card => {
                const nameElement = card.querySelector('.player-name');
                if (nameElement && nameElement.textContent.includes(playerName)) {
                    if (submitted) {
                        card.classList.add('submitted');
                        if (!card.querySelector('.checkmark')) {
                            const checkmark = document.createElement('div');
                            checkmark.className = 'checkmark';
                            checkmark.textContent = '✓';
                            card.appendChild(checkmark);
                        }
                    } else {
                        card.classList.remove('submitted');
                        const checkmark = card.querySelector('.checkmark');
                        if (checkmark) {
                            checkmark.remove();
                        }
                    }
                }
            });
        }

        function updateLeaderboard(leaderboard, containerId) {
            const container = document.getElementById(containerId);
            container.innerHTML = leaderboard.map((player, index) => `
                <div class="player-card ${player.id === currentPlayer.id ? 'you' : ''}">
                    <div class="player-name">
                        ${index === 0 ? '🥇' : index === 1 ? '🥈' : index === 2 ? '🥉' : `${index + 1}.`} 
                        ${player.name}${player.id === currentPlayer.id ? ' (You)' : ''}
                    </div>
                    <div class="player-score">${player.score} points</div>
                </div>
            `).join('');
        }

        function showMessage(text, type = 'info') {
            const container = document.getElementById('messageContainer');
            const message = document.createElement('div');
            message.className = `message ${type}`;
            message.textContent = text;
            
            container.appendChild(message);
            
            // Auto-remove after 5 seconds
            setTimeout(() => {
                if (message.parentNode) {
                    message.parentNode.removeChild(message);
                }
            }, 5000);
        }

        function sendMessage(message) {
            if (ws && ws.readyState === WebSocket.OPEN) {
                ws.send(JSON.stringify(message));
            } else {
                showMessage('Not connected to server', 'error');
            }
        }

        // Event listeners
        document.addEventListener('DOMContentLoaded', function() {
            // Enter key handling
            document.getElementById('playerName').addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    createRoom();
                }
            });
            
            document.getElementById('roomIdInput').addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    joinRoom();
                }
            });
            
            document.getElementById('wordInput').addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    submitWord();
                }
            });
            
            // Auto-uppercase room codes
            document.getElementById('roomIdInput').addEventListener('input', function(e) {
                e.target.value = e.target.value.toUpperCase();
            });
            
            // Focus player name input on load
            document.getElementById('playerName').focus();
        });

        // Initial setup
        window.addEventListener('beforeunload', function() {
            if (ws) {
                ws.close();
            }
        });
    </script>
</body>
</html>